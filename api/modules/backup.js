(()=>{"use strict";window.definePlugin("backup",(function(e){return{isLogin:e=>!!e.user.is_logged_in||(e.fire("account","login",(function(){e.fire("account")})),!1),onSelf(n,i){this.isLogin(n)&&(n.data("running")?n.error("busy"):(n.data("running",!0),n.fire(`${e.id}_status`,!0),n.fire("toolbar_state",e.id,"loading"),n.export().then((e=>n.fetch("storage/generate",{data:e}))).then((()=>{n.fire(`${e.id}_refetch`),i?n.success("done"):n.fire("notice",{key:e.id,type:"success",message:n.i18n("done"),okText:n.i18n("check")},(()=>{n.fire("setting","account",e.id)}))})).catch((e=>{n.error(e&&e.message?e.message:e)})).finally((()=>{n.data("running",!1),n.fire(`${e.id}_status`,!1),n.fire("toolbar_state",e.id,"loaded")}))))},onBackup_Recover(n,i){i&&this.isLogin(n)&&(n.data("running")?n.error("busy"):n.fire("notice",{duration:0,type:"warning",key:`use_${e.id}`,message:n.i18n("sure_use")},(()=>{n.data("running",!0),n.fetch("storage/get",{query:{id:i}}).then((e=>n.import(e.data))).then((()=>{n.success("success")})).catch((e=>{n.error(e&&e.message?e.message:e)})).finally((()=>{n.data("running",!1)}))})))},onBackup_Remove(n,i){i&&this.isLogin(n)&&(n.data("running")?n.error("busy"):n.fire("notice",{duration:0,type:"warning",key:`remove_${e.id}`,message:n.i18n("sure_remove")},(()=>{n.data("running",!0),n.fetch("storage/remove",{data:{id:i}}).then((()=>{n.fire(`${e.id}_refetch`)})).catch((e=>{n.error(e&&e.message?e.message:e)})).finally((()=>{n.data("running",!1)}))})))}}}))})();