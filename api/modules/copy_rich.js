(()=>{"use strict";function t(t){let e=t,n=t.cloneNode(!0);for(;e;){const r=e._mirrorElement;n._mirrorElement=r||e;const i=e.firstElementChild;if(i)e=i,n=n.firstElementChild;else{let r;for(;e!==t&&!(r=e.nextElementSibling);)e=e.parentElement,n=n.parentElement;if(e===t)break;e=r,n=n.nextElementSibling}}return n}function e(t=location.href){if(/circle=/.test(t)){const[e,n=""]=t.split("#");if(!n)return t;const{hashs:r}=function(t,e,n=location.hash.substring(1).split("&")){let r=[];if(n.join("").length<=0)return{hashs:[],hash:r};const i=Array.isArray(t)?t:[t],o=n.filter((t=>{if(i.findIndex((e=>t.indexOf(e)>=0))<0)return!0;r.push(t)}));if(e){const n=`${t}=${e}`;o.push(n),r=[],r.push(n)}return{hashs:o,hash:r}}(["circle","widget"],void 0,n.split("&"));return`${e}${r.length>0?"#"+r.join("&"):""}`}return t}function n(t,e){if(!t)return;let n=0;if(t.forEach){const r=t.length;if(r<=0)return;for(;n<r&&!e(t[n],n);)n++}else{const r=Object.keys(t),i=r.length;if(i<=0)return;for(;n<i&&!e(t[r[n]],r[n]);)n++}}function r(t,e){return Object.prototype.toString.call(t)===`[object ${e}]`}function i(t){return r(t,"Undefined")}function o(t){return r(t,"String")}function c(t){return t&&t.nodeType&&1===t.nodeType}function s(t){return r(t,"Number")}function l(e,r,i){if(r.querySelectorAll("img").length>0){const o=t(r),s=e.field("container");return c(s)&&s.style.cssText.indexOf("imagehide: none")>=0?n(o.querySelectorAll("img"),(t=>{let e=t;for(;e&&o.contains(e);){const t=e.parentElement;if(!t)break;if(!(t.innerText.trim().length<=0))break;t.removeChild(e),e=t}})):n(o.querySelectorAll("img"),(t=>{let e=t;t._mirrorElement&&(c(t._mirrorElement._mirrorElement)?e=t._mirrorElement._mirrorElement:c(t._mirrorElement)&&(e=t._mirrorElement));const r=[];if(n(t.attributes,(t=>{const e=t.nodeName;!["class","src"].includes(e)&&r.push(e)})),n(r,(e=>{t.removeAttribute(e)})),!i)return;const o=Math.max(e.width,t.width),s=Math.max(e.height,t.height),l=Math.min(o,410);t.width=l,t.height=s*(l/o),t.src=t.src.replace("https","http")})),o}return r}function a(t,n){const r=t.user,s={};["uid","mail","name","avatar"].forEach((t=>{s[t]=r[t]||""}));const a={};if(n)o(n)&&n.length>0?a.content=n.replace(/\n+/g,"<br />").trim():c(n)&&(a.content=n.innerHTML.trim());else{const n=function(t){const n=t.field("node");if(Array.isArray(n)&&n.length>0){const e=n[0];if(Array.isArray(e.content)){let n="";e.content.forEach((e=>{o(e.content)?n+=e.content:c(e.content)&&(n+=l(t,e.content).innerHTML.trim())}));const r=document.createElement("div");r.innerHTML=n,e.content=r}return c(e.content)&&(e.content=l(t,e.content)),e.title||(e.title=`${t.i18n("name")} - ${t.i18n("description")}`),Object.assign(Object.assign({},e),{content:c(e.content)?e.content.innerHTML.trim():e.content.trim(),title:c(e.title)?e.title.innerText.trim():e.title.trim(),tags:Array.isArray(e.tags)&&e.tags.length>0?e.tags.join(","):"",author:Array.isArray(e.author)&&e.author.length>0?e.author.map((t=>t.name)).join(","):""})}return{url:e(),title:document.title.trim(),content:document.body.innerHTML.trim()}}(t);Object.keys(n).forEach((t=>{i(n[t])||(a[t]=n[t])}))}return{node:a,app:{name:t.i18n("name"),version:`v${t.version}`,description:t.i18n("description")},user:Object.assign(Object.assign({},s),{url:t.path(`user/${s.uid||0}`)})}}function u(e,u,m){const f=[],h=a(e,m.part);return(Array.isArray(u)?u:[u]).forEach((a=>{let u="";if(m.option&&m.option[a])u=m.option[a].replace(/\[([^[|^\]]+)\]/g,((t,e)=>{const[n,o,c,l]=e.trim().split(":");if(n&&o){const t=h[n];if(r(t,"Object")){const e=t[o];if(i(e))return"";const n=`${e}`;if(c&&l){const t=parseFloat(c),e=parseFloat(l);if(s(t)&&t>=0&&s(e)&&e>0&&e>t){const r=n.slice(t,e);return e<n.length?`${r}...`:r}return n}return n}return""}return""}));else if(["template","part_template"].includes(a))if(m.part)o(m.part)&&m.part.length>0?u=function(t){if(!o(t))return!1;const e=document.createElement("div");e.innerHTML=t;let r=!1;return n(e.childNodes,(t=>{if(1===t.nodeType)return r=!0,!0})),r}(m.part)?m.part.replace(/\n+/g,"<br />").trim():m.part.trim():c(m.part)&&(u=m.part.innerHTML.trim());else{const n=e.field("container");if(c(n)){const r=n.querySelector(".page");if(c(r)){const n=t(r);(m.removeMeta?["footer","title","meta","cover","excerpt","noise"]:["noise"]).forEach((t=>{const e=n.querySelector(`.${t}`);e&&e.parentElement&&e.parentElement.removeChild(e)})),u=l(e,n,m.resizeImage).innerHTML.trim()}else u=h.node.content}else u=h.node.content}else{const t=a.split("_").shift()||"";u=h.node[t]||"--"}f.push(e.applyFilter(a,u,m))})),1===f.length?f[0]:f}window.definePlugin("copy_rich",(function(t){return(e,n)=>{e.option("option").then((r=>{const i={option:r,id:t.id},o=n?u(e,"part_template",{...i,part:n}):u(e,"template",i);e.fire("copy",o,!0),n||setTimeout((()=>{e.fire("remove_slogan_alert")}),3e3)}))}}))})();