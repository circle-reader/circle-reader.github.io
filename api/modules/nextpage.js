(()=>{"use strict";function t(t){return t&&t.nodeType&&1===t.nodeType}function e(t=location.href){if(/circle=/.test(t)){const[e,n=""]=t.split("#");if(!n)return t;const{hashs:r}=function(t,e,n=location.hash.substring(1).split("&")){let r=[];if(n.join("").length<=0)return{hashs:[],hash:r};const i=Array.isArray(t)?t:[t],o=n.filter((t=>{if(i.findIndex((e=>t.indexOf(e)>=0))<0)return!0;r.push(t)}));if(e){const n=`${t}=${e}`;o.push(n),r=[],r.push(n)}return{hashs:o,hash:r}}(["circle","widget"],void 0,n.split("&"));return`${e}${r.length>0?"#"+r.join("&"):""}`}return t}function n(t){const e=t.href,n=location.href;if(e&&e!==n&&!e.startsWith("javascript"))return e;let r="";if(function(t,e){if(!t)return;let n=0;if(t.forEach){const r=t.length;if(r<=0)return;for(;n<r&&!e(t[n],n);)n++}else{const r=Object.keys(t),i=r.length;if(i<=0)return;for(;n<i&&!e(t[r[n]],r[n]);)n++}}(t.attributes,(t=>{const e=`${t.nodeValue}`;if(e.split("/").length>1)return r=e.replace(/.*('|")(.*?)('|").*/,"$2"),!0})),r)return r;return t.getAttribute("onclick")||""?t:""}function r(t,e){return Object.prototype.toString.call(t)===`[object ${e}]`}function i(t){return r(t,"String")}function o(t,e){return!(!t||!t.tagName)&&t.tagName.toLowerCase()===e}function s(t){return t&&t.nodeType&&1===t.nodeType}function u(t,e){if(t)return e&&i(e)?t.getAttribute(e):Array.prototype.slice.call(t.attributes).reduce(((t,e)=>`${t} ${e.nodeValue}`),"")}function c(t){if(!t)return"";let e="";i(t)?e=t:!function(t){return r(t,"Text")}(t)?s(t)&&(e=t.textContent):e=t.nodeValue;const n=(e||"").trim();return n.length>0?n.replace(/^&nbsp;+|&nbsp;+$/g,""):""}const l=/下一[页頁条章篇张張]|next|next\s*page|次のページ/i;function f(t,e){let r;if(e){const i=function(t,e,n,r){if(!e)return n?[]:void 0;let i;try{i=t.querySelectorAll(e)}catch{}if(!i)return n?[]:void 0;if(n)return i.length>0?[...i]:[];if(r){const t=[];return i.forEach((e=>{if(o(e,"a")){const n=e.href;if(n.startsWith("javascript")){const n=c(e);n.length>0&&t.push(n)}else n.length>0&&t.push(n)}else{const n=c(e);n.length>0&&t.push(n)}})),t.join(" ")}return c(i[0])}(t,e);if(i&&o(i,"a")){const t=n(i);t&&(r=t)}}if(r)return r;const i=location.href,f=location.host;let a=null;return function(t,e){const n=Object.keys(t),r=n.length;if(r<=0)return;let i=r-1;for(;i>=0&&!e(t[n[i]],n[i]);)i--}(t.getElementsByTagName("a"),(t=>{const e=t.parentElement;if(t.host&&t.host!==f||!e)return;const n=t.href,r=c(t);if(n){if(l.test(`${u(t)} ${r}`)&&n!==i&&!n.startsWith("javascript"))return a=t,!0;if(1===e.childElementCount&&l.test(u(e)))return a=t,!0}else if(/下一[页頁章篇张張]/.test(r)||/next|next\s*page|次のページ/i.test(u(t)))return a=t,!0})),a&&s(a)?n(a):void 0}window.definePlugin("nextpage",(function(n,r){let i,o,s,u=0,c=document,l="wait";const a=(t=0)=>window.scrollY+window.innerHeight+t>=document.documentElement.scrollHeight,h=()=>{i?r.set("auto_run",!0,"apps").then((()=>{i.click()})):(l="wait",r.fire("render_refetch"),setTimeout((()=>{r.fire("scrollpage_again");const e=r.field("container");if(!t(e))return;const n=Array.from(e.querySelectorAll(".page")).pop();t(n)&&r.fire("speak_again",n)}),1e3))},d=(e,n)=>{const o=(t=>{const e=r.applyFilter("rule",{})||{};return f(t,e&&e.next?e.next:"")})(e);if(t(o))return l="done",void(i=o);o&&(l="running",r.fire("node_from_context_by_url",o,((t,e,i)=>{if(!i)return l="wait",void(s&&s());if(c=i,s&&s(),t)n(t);else{const t=r.field("node")||[];t.push(e),r.field("node",t),n()}})))};return{enable(t){t.warning("refresh")},start(){function t(){if("wait"!==l&&a(360))return"running"===l?(s&&s(),void(s=r.loading())):void h()}window.addEventListener("scroll",t),this.destory(),o=()=>{window.removeEventListener("scroll",t)},r.get("auto_run","apps").then((t=>{t&&r.remove("auto_run","apps").then((()=>{r.fire("action_clicked")}))}))},destory(){o&&o()},onRenderPage(){!r.field("running")||u>1||d(c.body,(t=>{if(t)return l="wait",u++,void this.onRenderPage();u=0,a()?h():l="done"}))},onRenderLeave(t){const n=t.field("node");if(!Array.isArray(n))return;const r=n.pop();r&&r.url!==e()&&setTimeout((function(){const t=location.hash;location.href=`${r.url}${t?"/":"#"}circle=off`}),1e3)}}}))})();