(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=ReactJsxRuntime,n=React,a=(0,n.createContext)({});function r(){return(0,n.useContext)(a)}function i(e,t){return Object.prototype.toString.call(e)===`[object ${t}]`}function o(e){return i(e,"String")}function s(e){return e&&e.nodeType&&1===e.nodeType}function p(e){return i(e,"Number")}function l(e){return i(e,"Function")}const c=classNames;var d=e.n(c);const u=Antd;var m=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};function h(e){const{type:n,width:a,children:i,placement:o,onCancel:s,className:p,rootClassName:l}=e,c=m(e,["type","width","children","placement","onCancel","className","rootClassName"]),{app:h}=r();return"toolbar"===n?(0,t.jsx)(u.Drawer,Object.assign({styles:{body:{padding:0}}},c,{mask:!1,width:a,onClose:s,className:p,rootClassName:d()("popup-toolbar",l),placement:h.device.phone?"bottom":o,children:i})):"modal"===n?(0,t.jsx)(u.Modal,Object.assign({},c,{onCancel:s,rootClassName:l,width:h.device.phone?"90%":a,className:d()(p,"popup-modal"),children:i})):(0,t.jsx)(u.Drawer,Object.assign({},c,{onClose:s,className:p,width:h.device.phone?"100%":a,rootClassName:d()("popup-drawer",l),placement:h.device.phone?"bottom":o,children:i}))}var f=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};function y(e){const{id:a,type:i,onCancel:o,onChange:l,onVisible:c,children:d,width:u=378,placement:m="right",destoryWithRender:y=!0}=e,g=f(e,["id","type","onCancel","onChange","onVisible","children","width","placement","destoryWithRender"]),x=(0,n.useRef)("0px"),b=(0,n.useRef)(null),{me:w,app:v,container:j}=r(),[C,O]=(0,n.useState)(!1),[S,_]=(0,n.useState)(8e3);return(0,n.useEffect)((()=>{const e=[];function t(e){if(e){const e=v.field("container");if(s(e)){const t=e.style.getPropertyValue("--offsetright");t&&(x.current=t)}v.fire("display",!0,"0px","offsetright"),j.style.display="none"}else v.fire("display",!0,x.current||"0px","offsetright"),x.current="",j.style.removeProperty("display")}return e.push(v.on("screenshot_change",t)),e.push(v.on("print_change",t)),e.push(v.on(a,((...e)=>{O((t=>{if(l){e.unshift(!t);if(l.apply(v,e))return t}return t||_((e=>{let t=e+10;const n=v.field("zIndex");return p(n)&&(t=n+10),v.field("zIndex",t),t})),c&&c(!t),!t}))}))),e.push(v.on(`${w.id}_enable`,(()=>{if(!v.device.phone&&!i){const e=v.field("container");if(s(e)){const t=e.style.getPropertyValue("--offsetright");t&&v.fire("display",!0,t,`offset${m}`)}}}))),()=>{e.forEach((e=>{e()}))}}),[]),(0,n.useEffect)((()=>{b.current&&clearTimeout(b.current),b.current=setTimeout((()=>{if(C){if(!v.device.phone&&!i){const e=v.field("container");if(s(e)){const t=e.style.getPropertyValue("--offsetright");t&&(x.current=t)}v.fire("display",!0,`${u}px`,`offset${m}`)}}else v.device.phone||i||v.fire("display",!0,x.current||"0px",`offset${m}`);v.fire("toolbar_state",a,C?"active":"inactive")}),500)}),[u,C]),(0,n.useEffect)((()=>v.on("render_leave",(()=>{y&&(c&&c(!1),O(!1))}))),[y]),(0,t.jsx)(h,Object.assign({type:i,open:C,width:u,zIndex:S,onCancel:e=>{c&&c(!1),O(!1),o&&o(e)},placement:m},g,{children:d}))}function g(e){const{app:n,value:a,onChange:r}=e;return(0,t.jsx)("div",{className:"pay-method",children:(0,t.jsx)(u.Space,{size:20,children:["wxpay","alipay","paypal"].map((e=>(0,t.jsx)(u.Image,{height:30,preview:!1,onClick:()=>r(e),src:n.path(`sites/default/files/assets/pay/${e}-icon.webp`),rootClassName:d()({active:e===a})},e)))})})}const{Title:x,Text:b}=u.Typography;function w(e){const{me:a,app:r,open:i,pay:o,data:s,onCancel:p}=e,[c,d]=(0,n.useState)(!1);return(0,t.jsx)(u.Modal,{open:i,footer:null,maskClosable:!1,onCancel:p,children:(0,t.jsxs)(u.Space,{size:20,direction:"vertical",className:"pay-wrapper",children:[(0,t.jsx)(x,{level:3,children:r.i18n("scan_pay")}),(0,t.jsx)(u.Image,{width:200,height:200,preview:!1,src:r.path(`sites/default/files/assets/pay/${o}.webp`)}),(0,t.jsx)(b,{children:r.i18n("scan_pay_tooltip",r.i18n(o),`${s}`)}),(0,t.jsx)(u.Button,{type:"primary",loading:c,onClick:()=>{d(!0),r.fetch("donate/generate",{data:{price:s}}).catch((e=>{r.error(e&&e.message?e.message:e)})).finally((function(){d(!1),p(),r.success("tips_success");const e=r.data(a.id);l(e)?(r.data(a.id,"destory"),e()):r.fire(a.id)}))},children:r.i18n("pay_done")})]})})}const{Text:v}=u.Typography;function j(){const e=[{id:"flower",value:"8.8"},{id:"drumsticks",value:"18.8"},{id:"coffee",value:"28.8"},{id:"meal",value:"98.8"},{id:"custom",value:"custom"}],{me:a,app:i}=r(),[o,s]=(0,n.useState)("wxpay"),[l,c]=(0,n.useState)(!1),[d,m]=(0,n.useState)("28.8"),[h,f]=(0,n.useState)(128.8),y="custom"==d?h:p(x=d)?x:parseFloat(x);var x;const b=e=>{f(e)};return(0,t.jsxs)("div",{children:[(0,t.jsx)(v,{italic:!0,type:"secondary",children:i.i18n("tips_title")}),(0,t.jsx)(u.Segmented,{block:!0,value:d,onChange:m,className:"tips-card",options:e.map((e=>({value:e.value,label:(0,t.jsxs)(u.Space,{direction:"vertical",children:[(0,t.jsx)(u.Image,{width:50,height:50,preview:!1,src:i.path(`sites/default/files/assets/donate/${e.id}.webp`)}),(0,t.jsx)(v,{strong:!0,children:i.i18n(e.id)}),"custom"==e.value?(0,t.jsx)(u.InputNumber,{min:0,value:h,defaultValue:0,onChange:b,variant:"custom"==d?"outlined":"borderless",formatter:e=>`짜 ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?.replace(/짜\s?|(,*)/g,"")}):(0,t.jsxs)(v,{children:["짜",e.value,i.i18n("unit")]})]})})))}),(0,t.jsx)(g,{app:i,value:o,onChange:s}),(0,t.jsx)(w,{me:a,app:i,pay:o,open:l,data:y,onCancel:()=>{c(!1)}}),(0,t.jsxs)(u.Space,{size:"small",direction:"vertical",className:"tips-action",children:[(0,t.jsx)(u.Button,{size:"large",type:"primary",onClick:()=>{c(!0)},disabled:y<=0,children:i.i18n("pay")}),(0,t.jsx)(u.Button,{type:"text",size:"small",target:"_blank",href:i.path("docs/payment.html"),children:(0,t.jsx)("i",{children:i.i18n("agree_license")})})]})]})}function C(e){if(o(e))return e;try{return JSON.stringify(e)}catch(t){return e.toString()}}const{Text:O,Title:S}=u.Typography;function _(){const{app:e,data:a}=function(e){const{uri:t,data:a,query:i,defaultValue:o=[]}=e,{me:s,app:p,container:l}=r(),[c,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(o),h=()=>{d(!0),p.fetch(t,{data:a,query:i}).then(m).catch((e=>{p.error(e&&e.message?e.message:e)})).finally((()=>{d(!1)}))};return(0,n.useEffect)(h,[C({data:a,query:i})]),{me:s,app:p,loading:c,refetch:h,container:l,data:u}}({uri:"donate/list",query:{start:1,limit:20,order:"price"},defaultValue:{total:0,items:[]}});return(0,t.jsx)(u.List,{dataSource:a.items,locale:{emptyText:(0,t.jsx)(u.Empty,{description:e.i18n("empty"),image:u.Empty.PRESENTED_IMAGE_SIMPLE})},header:(0,t.jsx)(O,{italic:!0,type:"secondary",children:e.i18n("bill_title")}),renderItem:n=>(0,t.jsx)(u.List.Item,{extra:(0,t.jsxs)(u.Space,{size:3,children:[(0,t.jsx)(O,{italic:!0,type:"secondary",children:"짜"}),(0,t.jsx)(S,{level:5,style:{marginBottom:0},children:n.price}),(0,t.jsx)(O,{type:"secondary",children:e.i18n("unit")})]}),children:n.name},n.id)})}function N(){const{me:e,app:a}=r(),[i,o]=(0,n.useState)("report"),s=[{key:"tips",label:a.i18n("tips"),children:(0,t.jsx)(j,{})},{key:"bills",label:a.i18n("bills"),children:(0,t.jsx)(_,{})}];return(0,n.useEffect)((()=>a.on(`${e.id}_route`,(e=>{o(e||"tips")}))),[]),(0,n.useEffect)((()=>{s.find((e=>e.key===i))||o(s[0].key)}),[i,s.length]),(0,t.jsx)(u.Tabs,{items:s,activeKey:i,onChange:o})}function E(){const{me:e,app:a}=r();return(0,n.useEffect)((()=>{a.fire("display")}),[]),location.hash.indexOf("mid=donate")>=0?(0,t.jsx)("div",{className:"outside-tab",children:(0,t.jsx)("div",{className:"inside-tab",children:(0,t.jsx)(N,{})})}):(0,t.jsx)(y,{id:e.id,width:700,type:"modal",footer:null,className:"wrapper",maskClosable:!1,onChange:(t,n,r)=>{if(!t)return n?(a.fire(`${e.id}_route`,n,r),!0):void 0;n?l(r)?(a.data(e.id,r),a.fire(`${e.id}_route`,n)):a.fire(`${e.id}_route`,n,r):a.fire(`${e.id}_route`,"tips")},onVisible:e=>{a.fire("scrollable",!e)},children:(0,t.jsx)(N,{})})}window.definePlugin("donate",(function(e,n,r){let i=null;return{start(){i||(i=r.display.render((({root:i,shadow:o,container:s})=>({app:n,me:e,children:(0,t.jsx)(E,{}),provider:(0,t.jsx)(a.Provider,{value:{app:n,root:i,shadow:o,container:s,me:e,dependencies:r}})})),{style:".container {\n  user-select: none;\n}\n.wrapper.ant-modal .ant-modal-content {\n  padding-top: 6px;\n  min-height: 500px;\n}\n.wrapper.ant-modal .ant-modal-content .ant-list-header {\n  padding-top: 0;\n}\n.wrapper.ant-modal .ant-modal-content .ant-typography.ant-typography-secondary {\n  opacity: 0.5;\n}\n.mobile .wrapper.ant-modal .ant-modal-content {\n  min-height: auto;\n}\n.tips-card.ant-segmented {\n  margin-top: 16px;\n}\n.tips-card.ant-segmented .ant-segmented-group {\n  justify-content: space-around;\n}\n.tips-card.ant-segmented .ant-segmented-group .ant-segmented-item {\n  width: 20%;\n  padding-top: 16px;\n  padding-bottom: 16px;\n}\n.tips-card.ant-segmented .ant-segmented-group .ant-segmented-item .ant-segmented-item-label > .ant-space {\n  display: flex;\n}\n.tips-card.ant-segmented .ant-segmented-group .ant-segmented-item .ant-segmented-item-label .ant-typography {\n  min-height: 32px;\n  display: block;\n}\n.tips-card.ant-segmented .ant-segmented-group .ant-segmented-item .ant-segmented-item-label .ant-input-number {\n  position: relative;\n  top: -4px;\n  text-align: center;\n  width: 100%;\n}\n.tips-card.ant-segmented .ant-segmented-group .ant-segmented-item .ant-segmented-item-label .ant-input-number input {\n  text-align: center;\n}\n.tips-card.ant-segmented .ant-segmented-group .ant-segmented-item.ant-segmented-item-selected .ant-segmented-item-label .ant-input-number {\n  top: -6px;\n}\n.pay-method {\n  text-align: center;\n  margin: 40px 0;\n}\n.pay-method .ant-space-item {\n  cursor: pointer;\n}\n.pay-method .ant-image {\n  filter: grayscale(100%);\n  filter: gray;\n}\n.pay-method .ant-image.active {\n  filter: grayscale(0);\n  filter: none;\n}\n.tips-action.ant-space {\n  width: 100%;\n  display: flex;\n  align-items: center;\n  margin-top: 20px;\n}\n.tips-action.ant-space .ant-btn-primary {\n  min-width: 330px;\n}\n.tips-action.ant-space .ant-btn-text {\n  font-size: 12px;\n  opacity: 0.5;\n}\n.pay-wrapper.ant-space {\n  width: 100%;\n  display: flex;\n  align-items: center;\n}\n.pay-wrapper.ant-space .ant-typography {\n  margin-bottom: 0;\n}\n.outside-tab {\n  background: var(--canvas);\n  padding: 80px 0;\n}\n.outside-tab .inside-tab {\n  min-height: 80vh;\n  max-width: 1000px;\n  border-radius: 10px;\n  padding: 7px 20px;\n  margin: 0 auto;\n  background: var(--bg);\n}\n\n.ant-drawer.popup-toolbar {\n  height: auto;\n  bottom: auto;\n  left: auto;\n}\n.ant-drawer.popup-toolbar .ant-drawer-content-wrapper {\n  height: auto !important;\n  width: auto !important;\n  position: static !important;\n}\n.ant-drawer.popup-toolbar .ant-drawer-content {\n  flex-direction: row-reverse;\n  align-items: start;\n}\n.ant-drawer.popup-toolbar .ant-drawer-header-close-only {\n  padding: 16px;\n  border: 0;\n}\n.ant-drawer.popup-toolbar .ant-drawer-header-close-only .ant-drawer-close {\n  margin-right: 0;\n}\n\n.mobile .ant-drawer.popup-toolbar .ant-drawer-content-wrapper {\n  overflow: auto;\n  max-height: 100vh !important;\n  width: 100vw !important;\n}\n\n",...n.applyFilter(`shadow_props_${e.id}`,{})}))},destory(){i&&(i(),i=null)}}}))})();