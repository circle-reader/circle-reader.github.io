(()=>{"use strict";function t(t,e){return!(!t||!t.tagName)&&t.tagName.toLowerCase()===e}function e(t,e){if(!t)return;let s=0;if(t.forEach){const i=t.length;if(i<=0)return;for(;s<i&&!e(t[s],s);)s++}else{const i=Object.keys(t),r=i.length;if(r<=0)return;for(;s<r&&!e(t[i[s]],i[s]);)s++}}const s=["feedback","focus","later","later__add","whitelist","whitelist_site","blacklist","blacklist_site","manual","enter_or_exit","setting"];window.definePlugin("keys",class{timer;keys;counter;map;constructor(e,s){this.keys=[],this.map={},this.counter=0,this.timer=null,document.addEventListener("keydown",(e=>{let i=document.activeElement;if(i&&i.shadowRoot&&i.shadowRoot.activeElement&&(i=i.shadowRoot.activeElement),t(i,"input")||t(i,"textarea"))return;if(i&&t(i,"div")&&"true"===i.contentEditable)return;const r=function(t){const e=(t.key||"").trim().length>0?t.key:t.code;if(!e||["alt","control","meta","shift"].includes(e.toLowerCase()))return"";const s=[];switch(e){case"？":s.push("?");break;case"Escape":s.push("esc");break;case"ArrowRight":s.push("→");break;case"ArrowLeft":s.push("←");break;case"ArrowUp":s.push("↑");break;case"ArrowDown":s.push("↓");break;default:s.push(e)}return t.altKey&&s.unshift("alt"),t.ctrlKey&&s.unshift("ctrl"),t.metaKey&&s.unshift("meta"),s.length<=0?"":s.join("+")}(e);if(r&&this.keys.push(r),this.counter++,1===this.counter)this.timer=setTimeout((()=>{this.counter=0,this.keys.length<=0||(this.fire(s,this.keys.join(" ")),this.keys=[])}),500);else if(2===this.counter){if(this.timer&&clearTimeout(this.timer),this.counter=0,this.keys.length<=0)return;this.fire(s,this.keys.join(" ")),this.keys=[]}}))}fire(t,i){let r="";e(this.map,((t,e)=>{if(t==i)return r=e,!0})),r&&(s.includes(r)||t.field("running")?(t.fire(r),t.record(`keys_${r}`)):t.record(`keys_${r}_valid`))}onTabActivated(t){this.start(t)}onKeysOption(t,e,s){e&&s&&(e.checked?this.map[s]=e.value:this.map[s]&&delete this.map[s])}start(t){t.option().then((t=>{this.map={},e(t,((t,e)=>{t.checked&&(this.map[e]=t.value)}))}))}destory(){this.map={}}})})();