(()=>{"use strict";function t(t){let e=t,n=t.cloneNode(!0);for(;e;){const r=e._mirrorElement;n._mirrorElement=r||e;const i=e.firstElementChild;if(i)e=i,n=n.firstElementChild;else{let r;for(;e!==t&&!(r=e.nextElementSibling);)e=e.parentElement,n=n.parentElement;if(e===t)break;e=r,n=n.nextElementSibling}}return n}function e(t=location.href){if(/circle=/.test(t)){const[e,n=""]=t.split("#");if(!n)return t;const{hashs:r}=function(t,e,n=location.hash.substring(1).split("&")){let r=[];if(n.join("").length<=0)return{hashs:[],hash:r};const i=Array.isArray(t)?t:[t],o=n.filter((t=>{if(i.findIndex((e=>t.indexOf(e)>=0))<0)return!0;r.push(t)}));if(e){const n=`${t}=${e}`;o.push(n),r=[],r.push(n)}return{hashs:o,hash:r}}(["circle","widget"],void 0,n.split("&"));return`${e}${r.length>0?"#"+r.join("&"):""}`}return t}function n(t,e){if(!t)return;let n=0;if(t.forEach){const r=t.length;if(r<=0)return;for(;n<r&&!e(t[n],n);)n++}else{const r=Object.keys(t),i=r.length;if(i<=0)return;for(;n<i&&!e(t[r[n]],r[n]);)n++}}function r(t,e){return Object.prototype.toString.call(t)===`[object ${e}]`}function i(t){return r(t,"Undefined")}function o(t){return r(t,"String")}function l(t){return t&&t.nodeType&&1===t.nodeType}function c(t){return r(t,"Number")}function s(t){return r(t,"Object")}function a(e,r,i){if(r.querySelectorAll("img").length>0){const o=t(r),c=e.field("container");return l(c)&&c.style.cssText.indexOf("imagehide: none")>=0?n(o.querySelectorAll("img"),(t=>{let e=t;for(;e&&o.contains(e);){const t=e.parentElement;if(!t)break;if(!(t.innerText.trim().length<=0))break;t.removeChild(e),e=t}})):n(o.querySelectorAll("img"),(t=>{let e=t;t._mirrorElement&&(l(t._mirrorElement._mirrorElement)?e=t._mirrorElement._mirrorElement:l(t._mirrorElement)&&(e=t._mirrorElement));const r=[];if(n(t.attributes,(t=>{const e=t.nodeName;!["class","src"].includes(e)&&r.push(e)})),n(r,(e=>{t.removeAttribute(e)})),!i)return;const o=Math.max(e.width,t.width),c=Math.max(e.height,t.height),s=Math.min(o,410);t.width=s,t.height=c*(s/o),t.src=t.src.replace("https","http")})),o}return r}function m(t,n){const r=t.user,c={};["uid","mail","name","avatar"].forEach((t=>{c[t]=r[t]||""}));const s={};if(n)o(n)&&n.length>0?s.content=n.replace(/\n+/g,"<br />").trim():l(n)&&(s.content=n.innerHTML.trim());else{const n=function(t){const n=t.field("node");if(Array.isArray(n)&&n.length>0){const e=n[0];if(Array.isArray(e.content)){let n="";e.content.forEach((e=>{o(e.content)?n+=e.content:l(e.content)&&(n+=a(t,e.content).innerHTML.trim())}));const r=document.createElement("div");r.innerHTML=n,e.content=r}return l(e.content)&&(e.content=a(t,e.content)),e.title||(e.title=`${t.i18n("name")} - ${t.i18n("description")}`),Object.assign(Object.assign({},e),{content:l(e.content)?e.content.innerHTML.trim():e.content.trim(),title:l(e.title)?e.title.innerText.trim():e.title.trim(),tags:Array.isArray(e.tags)&&e.tags.length>0?e.tags.join(","):"",author:Array.isArray(e.author)&&e.author.length>0?e.author.map((t=>t.name)).join(","):""})}return{url:e(),title:document.title.trim(),content:document.body.innerHTML.trim()}}(t);Object.keys(n).forEach((t=>{i(n[t])||(s[t]=n[t])}))}return{node:s,app:{name:t.i18n("name"),version:`v${t.version}`,description:t.i18n("description")},user:Object.assign(Object.assign({},c),{url:t.path(`user/${c.uid||0}`)})}}function u(e,r,u){const h=[],f=m(e,u.part);return(Array.isArray(r)?r:[r]).forEach((r=>{let m="";if(u.option&&u.option[r])m=u.option[r].replace(/\[([^[|^\]]+)\]/g,((t,e)=>{const[n,r,o,l]=e.trim().split(":");if(n&&r){const t=f[n];if(s(t)){const e=t[r];if(i(e))return"";const n=`${e}`;if(o&&l){const t=parseFloat(o),e=parseFloat(l);if(c(t)&&t>=0&&c(e)&&e>0&&e>t){const r=n.slice(t,e);return e<n.length?`${r}...`:r}return n}return n}return""}return""}));else if(["template","part_template"].includes(r))if(u.part)o(u.part)&&u.part.length>0?m=function(t){if(!o(t))return!1;const e=document.createElement("div");e.innerHTML=t;let r=!1;return n(e.childNodes,(t=>{if(1===t.nodeType)return r=!0,!0})),r}(u.part)?u.part.replace(/\n+/g,"<br />").trim():u.part.trim():l(u.part)&&(m=u.part.innerHTML.trim());else{const n=e.field("container");if(l(n)){const r=n.querySelector(".page");if(l(r)){const n=t(r);(u.removeMeta?["footer","title","meta","cover","excerpt","noise"]:["noise"]).forEach((t=>{const e=n.querySelector(`.${t}`);e&&e.parentElement&&e.parentElement.removeChild(e)})),m=a(e,n,u.resizeImage).innerHTML.trim()}else m=f.node.content}else m=f.node.content}else{const t=r.split("_").shift()||"";m=f.node[t]||"--"}h.push(e.applyFilter(r,m,u))})),1===h.length?h[0]:h}function h(t,e,n=""){return n?u(t,["title_part_template","part_template"],{...e,part:n}):u(t,["title_template","template"],e)}function f(t){let e=".container .ant-app{padding-right: 0 !important;}";const r=t.field("container");if(!l(r))return e;const i=r.parentNode;if(!i)return e;n(i.children,(t=>{if(!function(t,e){return!(!t||!t.tagName)&&t.tagName.toLowerCase()===e}(t,"style"))return;const n=t.textContent||"";n.length>0&&(e+=n.replace(/\s+/g," "))}));const o=[],c=r.style.cssText||'--margin: 80px; --padding: 80px; display: block; --font: "PingFang SC", system-ui, -apple-system, "system-ui", "Helvetica Neue", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif; --cnfont: "PingFang SC", system-ui, -apple-system, "system-ui", "Helvetica Neue", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif; --offsetright: 480px; --align: left; --blockspace: 20px; --imageleft: auto; --imageright: auto; --indent: 0em; --lineheight: 1.8; --size: 20px; --space: 0; --title1: 2em; --title1weight: 500; --title2: 1.6em; --title2weight: 500; --title3: 1.2em; --title3weight: 500; --title4: 1em; --title4weight: 500; --title5: 1em; --title5weight: 500; --title6: 1em; --title6weight: 500; --titlealign: left; --weight: 400; --width: 800px; --color: #1b1b1b; --link: #416ed2; --hover: #305ab7; --visited: #305ab7; --select: #1b1b1b; --selectbg: #bbd6fc; --bg-r: 237; --bg-g: 237; --bg-b: 237; --canvas: rgb(237, 237, 237); --bg: #ffffff; --title1color: #1b1b1b; --title2color: #1b1b1b; --title3color: #1b1b1b; --title4color: #1b1b1b; --title5color: #1b1b1b; --title6color: #1b1b1b;';return c.length>0&&c.split(";").forEach((function(t){const e=t.trim();e.startsWith("--")&&o.push(e)})),o.length>0&&n(o,(t=>{const[n,r]=t.split(":");e=e.replace(new RegExp(`var\\(${n}\\)`,"g"),r)})),e.replace(/\\n+/g," ")}function p(t,e,n){return["<!DOCTYPE html><html>","<head>",`<meta name="author" content="${t.i18n("name")}" />`,`<meta name="description" content="${t.i18n("generated_by")}" />`,'<meta http-equiv="Content-Type" content="text/html; charset=utf-8">',`<title>${n}</title>`,"</head>","<body>",`<div>${e}</div>`,"</body>","</html>"].join("")}function d(t,e,r){if(r)return Promise.resolve(e);const i=e.querySelectorAll("picture");i.length>0&&n(i,(t=>{const e=t.parentElement,n=t.querySelector("img"),r=t.querySelector("source");e&&r&&n&&e.replaceChild(n,t)}));const o=Array.from(e.querySelectorAll("img"));return o.length<=0?Promise.resolve(e):function(t,e){return t.fetch(e,{format:"blob",silence:!0}).then((t=>Promise.resolve(t.map((t=>t.data?{src:t.url,url:t.data}:{src:t.url,url:t.url})))))}(t,o.map((t=>t.src))).then((t=>(t.forEach((t=>{if(!s(t))return;const{src:e,url:n}=t,r=o.find((t=>t.src===e));r&&(r.src=n,["action","srcset","sizes"].forEach((t=>{r.removeAttribute(t)})))})),Promise.resolve(e))))}window.definePlugin("export_html",(function(t,e){const n=(n,r="",i=t.id)=>{const[o,c]=h(e,{option:n,id:t.id},r);e.fire("toolbar_state",i,"loading");const s=document.createElement("div");s.innerHTML=c,d(e,s,!(n&&n.inline)).then((t=>{e.fire("saver",function(t,e,n,r){let i=`${location.origin}/favicon.ico`;const o=document.head.querySelectorAll("link[rel~='icon']");if(1===o.length){const t=o[0].dataset.id;t&&(i=t)}return["<!DOCTYPE html><html>","<head>",`<meta name="author" content="${t.i18n("name")}" />`,`<meta name="description" content="${t.i18n("generated_by")}" />`,`<link rel="shortcut icon" type="image/x-icon" href="${i}"  />`,'<meta http-equiv="Content-Type" content="text/html; charset=utf-8">',`<style>html,body{padding:0;margin:0;}.card{min-height:100vh;}${f(t)}</style>`,`<title>${n}</title>`,"</head>","<body>",`<div class="${r}"><div class="ant-app"><div class="pages"><div class="page">${e}</div></div></div></div>`,"</body>","</html>"].join("")}(e,t.innerHTML,o,function(t,e){const n=[e?"card":""],r=t.field("container");return l(r)&&n.push(r.className),n.join(" ")}(e,!!r)),`${o}.html`),e.fire("toolbar_state",i,"loaded"),e.fire("remove_slogan_alert")}))};return{onSelf(t,e){t.option("option").then((t=>{n(t,e)}))},onExportHtml_Inline(t){t.user.roles.includes("member")||t.user.roles.includes("premium")?t.option("option").then((t=>{n({...t||{},inline:!0},"","export_html__inline")})):t.fire("subscribe")},data:n=>e.option("option").then((r=>{const[i,o]=h(e,{option:r,id:t.id,removeMeta:!0},n);return Promise.resolve({title:i,content:p(e,o,i)})}))}}))})();