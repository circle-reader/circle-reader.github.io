(()=>{"use strict";var e={760:e=>{function n({debug:e,max_extension_length:n=10,min_extension_length:t=1,min_filename_length:r=3,data:o}){if(e&&console.log("[parse-filename] starting with ",{debug:e,max_extension_length:n,min_extension_length:t,min_filename_length:r,data:o}),!o)throw new Error("[parse-filename] data is null or undefined");if("string"!=typeof o)throw new Error("[parse-filename] currently only supports data in string format not "+typeof o);let i;if(o.startsWith("http"))i=new URL(o).pathname;else if(o.match(/^[a-z0-9]+:\/\//))i=o.substr(o.indexOf("://")+3);else if(o.match(/^[A-Za-z]+@[A-Za-z\.]+:/))i=o.split(":").pop();else if(o.startsWith("./")||o.startsWith(".\\"))i=o.substr(1);else{if(!o.startsWith("/")&&!o.startsWith("\\"))throw new Error("[parse-filename] unsupported data path format");i=o}e&&console.log("[parse-filename] path:",i);const a=i.includes("\\")?"\\":"/";e&&console.log("[parse-filename] sep:",a);const s=i.split(a).pop();e&&console.log("[parse-filename]:",s);const l=s.indexOf(".");if(e&&console.log("[parse-filename] i:",l),l<r)return e&&console.log("[parse-filename] filename is too short"),{filename:null,extension:null};if(s.length-l<t)return e&&console.log("[parse-filename] extension too short"),{filename:null,extension:null};if(s.length-l>n)return{filename:null,extension:null};const c=s.substring(l+1);return e&&console.log("[parse-filename] extension:",c),{filename:s,extension:c}}e.exports=n,"object"==typeof window&&(window.parseFileName=n),"object"==typeof self&&(self.parseFileName=n)}},n={};function t(r){var o=n[r];if(void 0!==o)return o.exports;var i=n[r]={exports:{}};return e[r](i,i.exports,t),i.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n);const r=ReactJsxRuntime,o=React,i=(0,o.createContext)({});function a(){return(0,o.useContext)(i)}function s(e,n){if(!e)return;let t=0;if(e.forEach){const r=e.length;if(r<=0)return;for(;t<r&&!n(e[t],t);)t++}else{const r=Object.keys(e),o=r.length;if(o<=0)return;for(;t<o&&!n(e[r[t]],r[t]);)t++}}function l(e,n){return Object.prototype.toString.call(e)===`[object ${n}]`}function c(e){return l(e,"Undefined")}function u(e){return l(e,"String")}function p(e,n){return!(!e||!e.tagName)&&e.tagName.toLowerCase()===n}function d(e){return e&&e.nodeType&&1===e.nodeType}function f(e){return l(e,"Number")}function m(e){return l(e,"Function")}function g(e,n,t){if(!e)return;if(c(t))return n&&u(n)?e.getAttribute(n):Array.prototype.slice.call(e.attributes).reduce(((e,n)=>`${e} ${n.nodeValue}`),"");const r=f(t)&&!["zIndex","opacity"].includes(n)?`${t}px`:t;switch(n){case"innerHTML":case"innerText":case"className":case"textContent":e[n]=r;break;case"style":s(t,((n,t)=>{!function(e,n,t){if(e){if(c(t)){if(e[n])return e[n];if(e.style&&e.style[n])return e.style[n];if(window.getComputedStyle)return window.getComputedStyle(e,null)[n]}e.style[n]=f(t)&&!["zIndex","opacity"].includes(n)?`${t}px`:t}}(e,t,n)}));break;default:e.setAttribute(n,r)}}const h=Antd,x=AntDesignIcons;function y(){const{me:e,app:n}=a(),[t,i]=(0,o.useState)(""),s=()=>{n.fire(`${e.id}_download`,{src:t})},l=()=>{i(""),n.fire("scrollable",!0)};return(0,o.useEffect)((()=>{const t=[];return t.push(n.on(`${e.id}_narrow`,l)),t.push(n.on(`${e.id}_enlarge`,(e=>{i(e.src),n.fire("scrollable",!1)}))),t.push(n.on("click",((t,r)=>{if(p(t,"img")&&["zoom-in","zoom-out"].includes(g(t,"action"))){if(r.stopPropagation(),r.metaKey||r.ctrlKey)return n.tabs("create",{url:t.src}),void n.record("zoom-meta-exit");n.fire(`${e.id}_enlarge`,t)}}))),()=>{t.forEach((e=>{e()}))}}),[]),(0,r.jsx)(h.Image,{src:t,preview:{visible:!!t,closeIcon:(0,r.jsx)(x.CloseOutlined,{onClick:l}),toolbarRender:(e,{transform:{scale:n},actions:{onFlipY:t,onFlipX:o,onRotateLeft:i,onRotateRight:a,onZoomOut:l,onZoomIn:c}})=>(0,r.jsxs)(h.Space,{size:3,className:"ant-image-preview-operations",children:[(0,r.jsx)("div",{className:"ant-image-preview-operations-operation",onClick:s,children:(0,r.jsx)(x.DownloadOutlined,{})}),(0,r.jsx)("div",{className:"ant-image-preview-operations-operation",onClick:t,children:(0,r.jsx)(x.SwapOutlined,{rotate:90})}),(0,r.jsx)("div",{className:"ant-image-preview-operations-operation",onClick:o,children:(0,r.jsx)(x.SwapOutlined,{})}),(0,r.jsx)("div",{className:"ant-image-preview-operations-operation",onClick:i,children:(0,r.jsx)(x.RotateLeftOutlined,{})}),(0,r.jsx)("div",{className:"ant-image-preview-operations-operation",onClick:a,children:(0,r.jsx)(x.RotateRightOutlined,{})}),(0,r.jsx)("div",{className:"ant-image-preview-operations-operation",onClick:l,children:(0,r.jsx)(x.ZoomOutOutlined,{disabled:1===n})}),(0,r.jsx)("div",{className:"ant-image-preview-operations-operation",onClick:c,children:(0,r.jsx)(x.ZoomInOutlined,{disabled:50===n})})]})}})}var v=t(760),w=t.n(v);function b(e){return Array.isArray(e)?e.sort(((e,n)=>(e.priority||0)-(n.priority||0))):[]}let j=[];let _=null;function E(e,n){_&&clearTimeout(_),_=setTimeout((()=>{!function(e,n){const t={...e};j.forEach((({id:e,key:n,value:r})=>{(Array.isArray(e)?e:[[e,n,r]]).forEach((e=>{const[n,r,o]=e;t[n]&&(t[n][r]=o)}))})),n(t,!1),j=[]}(e,n),j.length>0&&E(e,n)}),100)}function C(){const{me:e,app:n,onChange:t,setValue:r,value:i}=function(e){const{id:n,disabled:t,defaultValue:r,fieldToListen:i}=e,{app:s,me:l,container:u}=a(),[p,d]=(0,o.useState)(r),f=()=>{t||s.option(n).then((e=>{!c(e)&&d(e)}))};return(0,o.useEffect)((()=>s.on("tab_activated",(e=>{e&&f()}))),[]),(0,o.useEffect)((()=>{f();let e="";e=i||(n&&"option"!==n?"display"===n?`${l.id}_display_${s.colorScheme.value?s.colorScheme.value+"_":""}option`:`${n}_option`:`${l.id}_option`);const t=[];return t.push(s.on(e,f)),t.push(s.on("color_scheme",f)),()=>{t.forEach((e=>{e()}))}}),[n]),{me:l,app:s,value:p,refetch:f,setValue:d,onChange:(e,r)=>{t||c(e)||s.option(n,e).then((()=>{d(e),m(r)&&r()})).catch((e=>{console.error(e),m(r)&&r(e.message)}))},container:u}}({id:"option",defaultValue:{}}),l=[];return s(i,((e,n)=>{e.checked&&l.push({...e,id:n})})),(0,o.useEffect)((()=>n.on(`${e.id}_state`,((e,n,o)=>{e&&function(e,n,t){j.push(e),Object.keys(n).length<=0||E(n,t)}({id:e,key:n,value:o},i,((e,n)=>{if(n){const n={};Object.keys(e).forEach((t=>{const{label:r,...o}=e[t];n[t]=o})),t(n)}else r(e)}))}))),[i]),{me:e,app:n,data:b(l)}}function k(e){const{onEnter:n,onLeave:t,onClick:o,onCreate:i,addText:a,emptyText:s}=e,{app:l,data:c}=C();return c.length<=0?(0,r.jsxs)("div",{className:"wrapper",children:[(0,r.jsx)("p",{children:s||l.i18n("no_buttons")}),(0,r.jsx)(h.Button,{size:"small",type:"primary",onClick:i,children:a||l.i18n("to_enable")})]}):(0,r.jsx)(h.Space,{size:0,children:c.map((e=>{if(e.loading)return(0,r.jsx)(h.Spin,{spinning:!0},e.id);const i=e.value&&x[e.value]?x[e.value]:null;return e.label?(0,r.jsx)(h.Tooltip,{title:e.label,children:(0,r.jsx)(h.Button,{type:"text",onClick:n=>{o&&o(n,e.id)},icon:i?(0,r.jsx)(i,{style:e.style}):(0,r.jsx)("span",{role:"img",tabIndex:-1,className:"anticon",dangerouslySetInnerHTML:{__html:e.value}})})},e.id):(0,r.jsx)(h.Button,{type:"text",onClick:n=>{o&&o(n,e.id)},onMouseEnter:t=>{n&&n(t,e.id)},onMouseLeave:n=>{t&&t(n,e.id)},icon:i?(0,r.jsx)(i,{style:e.style}):(0,r.jsx)("span",{role:"img",tabIndex:-1,className:"anticon",dangerouslySetInnerHTML:{__html:e.value}})},e.id)}))})}function $(){const{me:e,app:n,container:t}=a(),i=(0,o.useRef)(null),s=(0,o.useRef)(null),l=()=>{n.field("running")&&d(i.current)&&(s.current&&clearTimeout(s.current),s.current=setTimeout((()=>{i.current&&(i.current.style.display="none")}),200))},c=()=>{n.field("running")&&s.current&&clearTimeout(s.current)};return(0,o.useEffect)((()=>{const r=[];return r.push(n.on(`${e.id}_download`,(t=>{n.getApp("saver").then((()=>{const e=t.src;if(!e)return;let r="circle";if(0!==e.indexOf("data:")){const n=w()({data:e});n&&n.filename&&(r=n.filename)}n.fire("saver",e,r)})).catch((()=>{n.error("该操作依赖 “另存为文件” 组件，请先安装并启用")})).finally((()=>{n.record(`${e.id}_download`)}))}))),r.push(n.on(`${e.id}_exit`,(()=>{const r=t._mirrorElement;d(r)&&r.classList.contains("large")&&n.fire(`${e.id}_narrow`,r)}))),["render_leave","remove_img"].forEach((e=>{r.push(n.on(e,(()=>{i.current.style.display="none"})))})),()=>{r.forEach((e=>{e()}))}}),[]),(0,o.useEffect)((()=>{const e=n.field("container");if(!d(e))return;const r=e=>{if(!n.field("running")||n.field("busy"))return;const r=e.target;if(!p(r,"img")||!r.classList.contains("large"))return;s.current&&(clearTimeout(s.current),s.current=null);const o=window.scrollX,a=window.scrollY,l=window.innerWidth,c=r.getBoundingClientRect();i.current.style.top=`${c.top+a+8}px`,i.current.style.right=l-c.right-o+"px",i.current.style.display="flex",t._mirrorElement=r},o=e=>{if(!n.field("running")||n.field("busy"))return;const t=e.target;p(t,"img")&&t.classList.contains("large")&&(s.current&&clearTimeout(s.current),s.current=setTimeout((()=>{i.current.style.display="none"}),200))};return e.addEventListener("mouseover",r),e.addEventListener("mouseout",o),()=>{e.removeEventListener("mouseover",r),e.removeEventListener("mouseout",o)}}),[]),(0,r.jsx)("div",{ref:i,className:"toolbar",onBlur:l,onMouseOut:l,onFocus:c,onMouseOver:c,children:(0,r.jsx)(k,{onClick:(r,o)=>{o&&n.fire(`${e.id}_${o}`,t._mirrorElement,r)},onCreate:()=>{n.fire("setting","option",e.id),i.current.style.display="none"}})})}function O(){const{me:e,app:n}=a(),t=e=>{const n=e.width||e.naturalWidth,t=e.height||e.naturalHeight;(n>100||t>100)&&(e.setAttribute("action","zoom-in"),e.classList.contains("large")||e.classList.add("large"))};return(0,o.useEffect)((()=>n.on("render_page",(e=>{s(e.querySelectorAll("img"),(e=>{p(e.parentElement,"a")||(e.complete&&t(e),e.addEventListener("load",(function(){t(e)})))}))}))),[]),(0,o.useEffect)((()=>{const t=document.createElement("style");function r(){n.fire("insert_style",t)}t.textContent='img[action="zoom-in"] {cursor: zoom-in;}',r();const o=[];return o.push(n.on(`${e.id}_enabled`,r)),o.push(n.on(`${e.id}_disabled`,(function(){t&&t.parentElement&&t.parentElement.removeChild(t)}))),()=>{o.forEach((e=>{e()}))}}),[]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y,{}),(0,r.jsx)($,{})]})}window.definePlugin("gallery",(function(e,n,t){let o=null;return{start(){o||(o=t.display.render((({root:o,shadow:a,container:s})=>({app:n,me:e,children:(0,r.jsx)(O,{}),provider:(0,r.jsx)(i.Provider,{value:{app:n,root:o,shadow:a,container:s,me:e,dependencies:t}})})),{style:".wrapper {\n  line-height: 1.6em;\n  background: var(--bg);\n  border-radius: 3px;\n  padding: 2px 10px 6px;\n  text-align: center;\n  font-size: 14px;\n  box-shadow: 0 2px 10px var(--canvas);\n}\n.wrapper p {\n  margin: 0 0 2px;\n}\n\n.container .ant-image {\n  display: none;\n}\n.container .ant-image-preview-operations-wrapper .ant-image-preview-close {\n  padding: 1px;\n}\n.container .ant-image-preview-operations-wrapper .ant-image-preview-close > .anticon {\n  padding: 10px;\n}\n.toolbar {\n  user-select: none;\n  position: absolute;\n  right: 0;\n  top: 0;\n  z-index: 2;\n  line-height: 0;\n  display: none;\n  flex-wrap: nowrap;\n  justify-content: center;\n  align-items: center;\n}\n.toolbar .anticon {\n  opacity: 0.6;\n  cursor: pointer;\n  padding: 4px;\n  margin: 0 2px;\n  border-radius: 3px;\n  background: var(--canvas);\n  box-shadow: 0 0 6px rgba(0, 0, 0, 0.15);\n}\n.toolbar .anticon svg {\n  pointer-events: none;\n}\n.toolbar .anticon:hover {\n  opacity: 1;\n}\n\n",syncWithRender:!1}))},destory(){o&&(o(),o=null)}}}))})();