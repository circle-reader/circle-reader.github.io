(()=>{"use strict";function e(e,t){return Object.prototype.toString.call(e)===`[object ${t}]`}function t(e){return e&&e.nodeType&&1===e.nodeType}function n(t){return e(t,"Function")}function o(e,t){if(!e)return;let n=0;if(e.forEach){const o=e.length;if(o<=0)return;for(;n<o&&!t(e[n],n);)n++}else{const o=Object.keys(e),i=o.length;if(i<=0)return;for(;n<i&&!t(e[o[n]],o[n]);)n++}}var i=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};window.definePlugin("edit",(function(e){return{onScreenshotChange(e,t){t&&this.onBusy(e)},onPrintChange(e,t){t&&this.onBusy(e)},onClick(t,n,o,i){t.data(e.id)&&!i.contains(n)&&this.onBusy(t)},_run(n){if(n.data(e.id))return;n.field("busy",!0),n.data(e.id,!0);const i=n.field("container");t(i)&&(o(i.querySelectorAll(".page"),(e=>{e.setAttribute("contenteditable","true"),e.style.outline="1px solid var(--link)"})),n.fire("toolbar_state",e.id,"active"),function(e,t,n){e.get("alert").then((o=>{o?t&&t(!0):e.fire("notice",{duration:5,onClose:t,message:e.i18n("alert"),btnText:n||e.i18n("got_it")},(()=>{e.set("alert",!0)}))}))}(n))},onBusy(n){if(!n.data(e.id))return;n.data(e.id,"destory");const i=n.field("container");t(i)&&(o(i.querySelectorAll(".page"),(e=>{e.removeAttribute("contenteditable"),e.style.removeProperty("outline")})),n.fire("toolbar_state",e.id,"inactive"),n.field("busy",!1))},onSelf(t){t.data(e.id)?this.onBusy(t):(t.fire("busy"),setTimeout((()=>{this._run(t),"firefox"!==t.device.browser||(t.config||{}).compatible||function(e,t){const o=t||{},r=o.id||"power";e.get(r,o.table).then((t=>{if(t)return;const{onOk:a,onCancel:s,message:c,okText:l,cancelText:u}=o,f=i(o,["onOk","onCancel","message","okText","cancelText"]);a&&n(a)?s&&n(s)?e.fire("notice",Object.assign({type:"warning",onClose:s,okText:l||e.i18n("ok"),message:c||e.i18n("power"),cancelText:u||e.i18n("cancel")},f),(()=>{!a()&&e.set(r,!0,o.table)}),(()=>{!s()&&e.set(r,!0,o.table)})):e.fire("notice",Object.assign({type:"warning",onClose:s,okText:l||e.i18n("ok"),message:c||e.i18n("power")},f),(()=>{!a()&&e.set(r,!0,o.table)})):e.fire("notice",Object.assign({type:"warning",onClose:s,message:c||e.i18n("power")},f))}))}(t,{duration:0,table:"apps",id:"enable_compatible",onOk:()=>{t.fire("setting","option","compatible")},onCancel:()=>{}})}),100))}}}))})();