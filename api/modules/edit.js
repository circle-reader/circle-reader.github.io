(()=>{"use strict";function e(e){return e&&e.nodeType&&1===e.nodeType}function t(e,t){if(!e)return;let n=0;if(e.forEach){const i=e.length;if(i<=0)return;for(;n<i&&!t(e[n],n);)n++}else{const i=Object.keys(e),o=i.length;if(o<=0)return;for(;n<o&&!t(e[i[n]],i[n]);)n++}}window.definePlugin("edit",(function(n){return{onScreenshotChange(e,t){t&&this.onBusy(e)},onPrintChange(e,t){t&&this.onBusy(e)},onClick(e,t,i,o){e.data(n.id)&&!o.contains(t)&&this.onBusy(e)},_run(i){if(i.data(n.id))return;i.field("busy",!0),i.data(n.id,!0);const o=i.field("container");e(o)&&(t(o.querySelectorAll(".page"),(e=>{e.setAttribute("contenteditable","true"),e.style.outline="1px solid var(--link)"})),i.fire("toolbar_state",n.id,"active"),function(e,t,n){e.get("alert").then((i=>{i?t&&t(!0):e.fire("notice",{duration:5,onClose:t,message:e.i18n("alert"),btnText:n||e.i18n("got_it")},(()=>{e.set("alert",!0)}))}))}(i))},onBusy(i){if(!i.data(n.id))return;i.data(n.id,"destory");const o=i.field("container");e(o)&&(t(o.querySelectorAll(".page"),(e=>{e.removeAttribute("contenteditable"),e.style.removeProperty("outline")})),i.fire("toolbar_state",n.id,"inactive"),i.field("busy",!1))},onSelf(e){e.data(n.id)?this.onBusy(e):(e.fire("busy"),setTimeout((()=>{this._run(e)}),100))}}}))})();